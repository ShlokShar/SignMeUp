<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SignMeUp</title>
  <link href="../static/css/output.css" rel="stylesheet">
  <link href="../static/css/animation.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <style>
    html {
      scroll-behavior: smooth;
    }
    .no-select {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      cursor: default;
    }
    #current-sign {
      pointer-events: none;
    }
    .video-container {
      position: relative;
      display: inline-block;
    }
    .asl-overlay {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 12px;
      padding: 12px;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      z-index: 10;
      max-width: 200px;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .asl-overlay.hidden {
      opacity: 0;
      transform: translateY(20px);
    }
    .asl-overlay img {
      max-width: 80px;
      max-height: 80px;
      object-fit: contain;
      border-radius: 8px;
    }
    .asl-overlay .word-text {
      color: white;
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      margin-top: 8px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }
    .asl-overlay .lexical-class {
      color: #e5e7eb;
      font-size: 12px;
      font-weight: 400;
      text-align: center;
      margin-top: 4px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    }

    .overlay-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border: none;
      border-radius: 20px;
      padding: 8px 16px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      z-index: 11;
      backdrop-filter: blur(5px);
    }
    .gallery img, .gallery video {
      width: 100%;
      height: auto;
      object-fit: cover;
      border-radius: 16px;
    }
    
    .gallery video {
      object-position: left top;
    }
    
    /* Progress bar styles */
    .progress-container {
      width: 100%;
      background-color: #e5e7eb;
      border-radius: 9999px;
      height: 8px;
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(to right, #3b82f6, #8b5cf6);
      border-radius: 9999px;
      transition: width 0.3s ease-out;
      width: 0%;
    }
    
    .step-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 4px 0;
    }
    
    .step-dot {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    
    .step-dot.pending {
      background-color: #d1d5db;
    }
    
    .step-dot.active {
      background-color: #3b82f6;
      animation: pulse 2s infinite;
    }
    
    .step-dot.completed {
      background-color: #10b981;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body class="flex min-h-screen w-full flex-col items-center space-y-[76px] pb-8">
  <nav class="w-full flex flex-row justify-between px-[20px] py-[12px] items-center">
    <div class="flex flex-row space-x-[8px] justify-center items-center">
      <img src="../static/img/logo.png" width="48px" height="48px">
      <p class="font-poppins font-semibold text-[24px]">SignMeUp</p>
    </div>
    <div class="absolute left-1/2 transform -translate-x-1/2 flex flex-row space-x-[8px] items-center text-[16px] text-[#5A5A5A] font-poppins font-medium">
      <a class="cursor-pointer" href="">Inspiration</a>
      <div class="w-[4px] h-[4px] bg-gray-500 rounded-full"></div>
      <a class="cursor-pointer" href="https://hello-world-2025.devpost.com/?ref_feature=challenge&ref_medium=your-open-hackathons&ref_content=Submissions+open&_gl=1*crt6k8*_gcl_au*NjM5ODg0MjA4LjE3NTgzOTU4Mzc.*_ga*ODY5MzE5NTQ4LjE3NTAwOTIyOTc.*_ga_0YHJK3Y10M*czE3NTg0Mjc2OTkkbzYkZzAkdDE3NTg0Mjc2OTkkajYwJGwwJGgw">Devpost</a>
      <div class="w-[4px] h-[4px] bg-gray-500 rounded-full"></div>
      <a class="cursor-pointer" href="https://github.com/ShlokShar/SignMeUp">Source Code</a>
    </div>
    <a class="flex flex-row space-x-[14px] justify-between items-center text-[16px] cursor-pointer hover:translate-y-0.5 duration-200" href="#upload-container">
      <div class="bg-black px-3.5 py-2 text-white rounded-[15px]">Try Now</div>
    </a>
  </nav>
  
  <div class="flex flex-col space-y-[38px] items-center">
    <div class="flex flex-col space-y-[12px] items-center">
      <div class="flex flex-row space-x-2 bg-accent py-2 pl-2 pr-3 rounded-full items-center">
        <img class="bg-white rounded-full p-2 w-10 h-10" src="../static/img/deaf.png" alt="ear icon">
        <p class="font-poppins italic text-[16px]">Made for the 11 million deaf Americans</p>
      </div>
      <p class="font-poppins font-medium text-[60px] leading-[70px] max-w-[600px] text-center">Stories Should Be Understood by All</p>
      <p class="font-regular text-[18px] leading-[20px] max-w-[600px] text-center text-[#696969] ">Sign Me Up makes speech captions clear for ASL, so no one misses out.</p>
    </div>
    <a href="#upload-container" class="cursor-pointer font-poppins font-semibold text-[20px] relative inline-flex items-center justify-center p-4 px-6 py-3 overflow-hidden text-accent transition duration-300 ease-out border-2 border-accent rounded-full shadow-md group hover:translate-y-0.5">
      <span class="absolute inset-0 flex items-center justify-center w-full h-full text-primary duration-300 -translate-x-full bg-white group-hover:translate-x-0 ease"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg></span>
      <span class="absolute flex items-center justify-center w-full h-full bg-primary text-white transition-all duration-500 transform group-hover:translate-x-full ease">Upload Video</span>
      <span class="relative invisible">Upload Video</span>
    </a>
  </div>
  
  <div class="gallery flex flex-row space-x-2 justify-center">
    <div class="flex flex-col w-1/3 items-end justify-between space-y-2">
      <img src="../static/img/image 1.png">
      <img src="../static/img/image 2.png">
      <img src="../static/img/image 3.png">
    </div>
    <div class="flex flex-col w-1/3 items-center justify-between space-y-2">
      <img src="../static/img/image 4.png">
      <img src="../static/img/image 5.png">
      <img src="../static/img/image 6.png">
    </div>
    <div class="flex flex-col w-1/3 items-start justify-between space-y-2">
      <img src="../static/img/image 7.png">
      <img src="../static/img/image 8.png">
      <img src="../static/img/image 9.png">
    </div>
  </div>
  
  <div id="upload-container" class="upload-container flex flex-col items-center space-y-[38px] relative">
    <p class="font-poppins font-semibold text-[22px]">Upload</p>
    <div class="relative">
      <div class="absolute inset-0 rounded-[20px] bg-gradient-to-r from-primary to-accent blur-2xl opacity-40"></div>
      <label 
        for="file-upload" 
        id="drop-area"
        class="relative cursor-pointer flex flex-col justify-center items-center w-[600px] h-[400px] bg-white border-2 border-dashed rounded-[20px] border-[#B4B4B4] space-y-4"
      >
        <img class="upload-icon" src="../static/img/upload.png" width="60px">
        <p class="text-[14px]">Drag & Drop your file here or <span class="underline font-bold">Choose file</span></p>
      </label>
    </div>
    <input id="file-upload" type="file" class="hidden" accept="video/*" />
  </div>

  <div id="video-display" class="hidden flex flex-col items-center space-y-[38px] w-[600px] py-8">
    <h2 class="font-poppins font-semibold text-[22px]">Result</h2>
    
    <div class="video-container">
      <video 
        id="uploaded-video"
        class="w-[600px] h-[338px] rounded-lg shadow-lg object-cover"
        controls
        preload="metadata"
      > 
        <source id="video-source" src="" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      
      <!-- Toggle button for overlay -->
      <button id="overlay-toggle" class="overlay-toggle">
        ASL On
      </button>
      

      
      <!-- ASL overlay -->
      <div id="asl-overlay" class="asl-overlay hidden">
        <div id="current-sign-overlay" class="no-select">
        </div>
      </div>
    </div>
    
    <div id="processing-indicator" class="hidden flex flex-col items-center space-y-6">
      <div class="flex flex-col items-center space-y-4">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
        <p id="processing-text" class="font-poppins text-[16px] text-[#696969]">Processing video for ASL translation...</p>
      </div>
      
      <!-- Progress bar container -->
      <div class="progress-container w-[400px]">
        <div id="progress-bar" class="progress-bar"></div>
      </div>
      
      <!-- Progress steps -->
      <div class="flex flex-col space-y-2 text-sm text-gray-600 w-[400px]">
        <div id="step-upload" class="step-indicator">
          <div class="step-dot pending"></div>
          <span>Uploading video...</span>
        </div>
        <div id="step-extract" class="step-indicator">
          <div class="step-dot pending"></div>
          <span>Extracting audio...</span>
        </div>
        <div id="step-transcribe" class="step-indicator">
          <div class="step-dot pending"></div>
          <span>Transcribing speech...</span>
        </div>
        <div id="step-asl" class="step-indicator">
          <div class="step-dot pending"></div>
          <span>Generating ASL signs...</span>
        </div>
      </div>
      
      <!-- Estimated time -->
      <p id="estimated-time" class="text-xs text-gray-500">Estimated time: 30-60 seconds</p>
    </div>
    

  </div>

  <script>
    let aslDictionary = {};
    let currentSigns = [];
    let currentSignIndex = 0;
    let slideInterval = null;
    let overlayEnabled = true;
    let autoAdvance = true;
    let processingSteps = ['step-upload', 'step-extract', 'step-transcribe', 'step-asl'];
    let currentStep = 0;

    document.addEventListener('DOMContentLoaded', function() {
      const fileUpload = document.getElementById('file-upload');
      const dropArea = document.getElementById('drop-area');
      const videoDisplay = document.getElementById('video-display');
      const videoSource = document.getElementById('video-source');
      const uploadedVideo = document.getElementById('uploaded-video');
      const processingIndicator = document.getElementById('processing-indicator');
      const processingText = document.getElementById('processing-text');
      const progressBar = document.getElementById('progress-bar');
      const estimatedTime = document.getElementById('estimated-time');

      const currentSignOverlay = document.getElementById('current-sign-overlay');
      const aslOverlay = document.getElementById('asl-overlay');
      const overlayToggle = document.getElementById('overlay-toggle');

      const signIndicators = document.getElementById('sign-indicators');
      const signCounter = document.getElementById('sign-counter');

      loadASLDictionary();

      fileUpload.addEventListener('change', (e) => handleFile(e.target.files[0]));

      dropArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropArea.classList.add('border-primary');
      });

      dropArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        dropArea.classList.remove('border-primary');
      });

      dropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        dropArea.classList.remove('border-primary');
        if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
      });

      uploadedVideo.addEventListener('play', () => {
        if (autoAdvance) startSlideshow();
      });
      
      uploadedVideo.addEventListener('pause', () => {
        clearInterval(slideInterval);
      });
      
      uploadedVideo.addEventListener('ended', () => {
        clearInterval(slideInterval);
        showSign(0);
      });

      overlayToggle.addEventListener('click', () => {
        overlayEnabled = !overlayEnabled;
        aslOverlay.classList.toggle('hidden', !overlayEnabled);
        overlayToggle.textContent = overlayEnabled ? 'ASL On' : 'ASL Off';
        
        if (overlayEnabled && currentSigns.length > 0) {
          showSignOverlay(currentSignIndex);
        }
      });

      function handleFile(file) {
        if (file && file.type.startsWith('video/')) {
          videoSource.src = URL.createObjectURL(file);
          uploadedVideo.load();
          document.getElementById('upload-container').classList.add('hidden');
          processingIndicator.classList.remove('hidden');
          processingIndicator.scrollIntoView({ behavior: 'smooth' });
          uploadAndProcess(file);
        } else {
          alert('Please upload a valid video file.');
        }
      }

      function uploadAndProcess(file) {
        const formData = new FormData();
        formData.append('file', file);

        currentStep = 0;
        updateProgress(0, "Uploading video...");

        fetch('/upload', { method: 'POST', body: formData })
        .then(response => {
          updateProgress(25, "Extracting audio...");
          return response.json();
        })
        .then(data => {
          updateProgress(50, "Transcribing speech...");
          
          setTimeout(() => {
            updateProgress(75, "Generating ASL signs...");
            
            setTimeout(() => {
              updateProgress(100, "Complete!");
              
              setTimeout(() => {
                processingIndicator.classList.add('hidden');
                if (data.result) {
                  videoDisplay.classList.remove('hidden');
                  displayASLSigns(data.result);
                  videoDisplay.scrollIntoView({ behavior: 'smooth' });
                } else {
                  document.getElementById('upload-container').classList.remove('hidden');
                  alert('Error processing video: ' + (data.error || 'No result returned'));
                }
              }, 500);
            }, 1000);
          }, 1000);
        })
        .catch(error => {
          processingIndicator.classList.add('hidden');
          document.getElementById('upload-container').classList.remove('hidden');
          alert('Error uploading file. Please try again.');
        });
      }

      function updateProgress(percentage, message) {
        progressBar.style.width = percentage + '%';
        processingText.textContent = message;
        
        const stepIndex = Math.floor((percentage / 100) * processingSteps.length);
        
        processingSteps.forEach((stepId, index) => {
          const stepElement = document.getElementById(stepId);
          const indicator = stepElement.querySelector('.step-dot');
          
          if (index < stepIndex) {
            indicator.className = 'step-dot completed';
          } else if (index === stepIndex) {
            indicator.className = 'step-dot active';
          } else {
            indicator.className = 'step-dot pending';
          }
        });
        

        if (percentage < 100) {
          const remainingSeconds = Math.max(5, 60 - (percentage * 0.6));
          estimatedTime.textContent = `Estimated time remaining: ${Math.ceil(remainingSeconds)} seconds`;
        } else {
          estimatedTime.textContent = "Processing complete!";
        }
      }

      async function loadASLDictionary() {
        try {
          const response = await fetch('/static/ASL-LEX View Data.csv');
          if (!response.ok) return;
          
          const csvContent = await response.text();
          const lines = csvContent.split('\n');
          const headers = lines[0].split(',').map(h => h.replace(/^"|"$/g, '').trim());
          
          const entryIdIndex = headers.findIndex(h => h.toLowerCase().includes('entry id'));
          const handshapeImageIndex = headers.findIndex(h => h.toLowerCase().includes('handshape image'));
          const lexicalClassIndex = headers.findIndex(h => h.toLowerCase().includes('lexical class'));
          
          if (entryIdIndex === -1 || handshapeImageIndex === -1) return;

          for (let i = 1; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;
            
            const row = parseCSVLine(line);
            const entryId = row[entryIdIndex]?.replace(/^"|"$/g, '').trim();
            const handshapeImage = row[handshapeImageIndex]?.replace(/^"|"$/g, '').trim();
            
            if (entryId && handshapeImage && handshapeImage !== 'N/A' && handshapeImage.includes('src=')) {
              const word = entryId.replace(/_/g, ' ').toLowerCase();
              const match = handshapeImage.match(/src="([^"]+)"/);
              if (match) {
                const lexicalClass = row[lexicalClassIndex]?.replace(/^"|"$/g, '').trim() || 'Unknown';
                aslDictionary[word] = {
                  imageUrl: match[1],
                  lexicalClass: lexicalClass
                };
              }
            }
          }
        } catch (error) {
          console.warn('Could not load ASL dictionary');
        }
      }

      function parseCSVLine(line) {
        const result = [];
        let current = '';
        let inQuotes = false;
        
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          if (char === '"') {
            if (inQuotes && line[i + 1] === '"') {
              current += '"';
              i++;
            } else {
              inQuotes = !inQuotes;
            }
          } else if (char === ',' && !inQuotes) {
            result.push(current);
            current = '';
          } else {
            current += char;
          }
        }
        result.push(current);
        return result;
      }

      function displayASLSigns(resultText) {
        const words = resultText.toLowerCase().replace(/[^\w\s]/g, '').split(/\s+/).filter(word => word.length > 0);
        currentSigns = words.map(word => ({ word, signData: aslDictionary[word] }));
        
        if (currentSigns.length === 0) return;
        
        currentSignIndex = 0;
        

        if (overlayEnabled) {
          aslOverlay.classList.remove('hidden');
          showSignOverlay(0);
        }
      }

      function createIndicators() {

      }

      function showSign(index) {
        if (index < 0 || index >= currentSigns.length) return;
        
        currentSignIndex = index;
        
        if (overlayEnabled && !aslOverlay.classList.contains('hidden')) {
          showSignOverlay(index);
        }
      }

      function showSignOverlay(index) {
        if (index < 0 || index >= currentSigns.length) return;
        
        const { word, signData } = currentSigns[index];
        
        if (signData?.imageUrl) {
          currentSignOverlay.innerHTML = `
            <img src="${signData.imageUrl}" alt="${word}" onerror="this.style.display='none';">
            <div class="word-text">${word.toUpperCase()}</div>
            <div class="lexical-class">${signData.lexicalClass}</div>
          `;
        } else {
          currentSignOverlay.innerHTML = `
            <div class="word-text" style="margin-top: 0;">${word.toUpperCase()}</div>
            <div class="lexical-class">No sign image available</div>
          `;
        }
      }

      function startSlideshow() {
        if (!autoAdvance) return;
        
        clearInterval(slideInterval);
        const duration = uploadedVideo.duration;
        const interval = duration && currentSigns.length ? Math.max(500, Math.min(10000, (duration / currentSigns.length) * 1000)) : 2000;
        
        slideInterval = setInterval(() => {
          const nextIndex = currentSignIndex < currentSigns.length - 1 ? currentSignIndex + 1 : 0;
          showSign(nextIndex);
        }, interval);
      }
    });
  </script>

  <script src="../static/js/script.js"></script>
</body>
</html>
